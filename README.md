# Lokki 

Command line billing.

## Installation

  Add the downloaded directory to your path.

### Dependencies

  *  **SQLAclhemy:** sudo pip install SQLAlchemy
  *  **prettytable:** sudo pip install prettytable

## Usage

### Initializing database

    lk init db_path.sqlite

  Init command disregards the currently selected database as this could cause 
  data loss.

### Selecting database
  
  The active database is selected by the environment variable LK\_DB\_PATH. It 
  should contain a path to an SQLite database.

  Lakki is able to start a shell session with the variable set:

    lk shell db_path.sqlite

  If a relative path is specified, it is converted to an absolute path before
  starting the shell.

### Managing settings

    lk config set setting-name value

    lk config get \[setting-name\]

    lk config list

#### Available settings

##### sender-name
  **Required.** Sender name, displayed in invoices. 

##### sender-address
  **Required.** Sender street address, displayed in invoices.

##### sender-zip-code
  **Required.** Sender ZIP code, displayed in invoices.

##### sender-city
  **Required.** Sender city, displayed in invoices.

##### sender-iban
  **Required.** Sender IBAN, displayed in invoices.

##### sender-country
  Sender country, displayed in invoices.

##### next-invoice-number
  Number of the invoice.

##### default-due-days
  Default number of days from the generation of the bill.

##### default-client
  Handle of the default recipient of the bills.

##### default-vat
  Percentage of default VAT to add.

##### bill-filename-template
  Template of the bill filename. Available tokens: 
###### {{d}} 
  Two-digit day of the month
###### {{m}} 
  Two-digit month
###### {{y}} 
  Four-digit year
###### {{n}} 
  Number of the invoice

### Managing clients

#### Adding client

    lk client add handle \[name\] \[address\] \[zip-code\] \[city\] \[country\]

  Client may be added incomplete, but it may not be used until all required
  settings are set.

#### Setting client setting

    lk client set handle setting-name setting-value

#### Getting client setting

    lk client get handle setting-name

#### Removing client

    lk client remove handle

  Clients with billed invoices may not be removed.

#### Listing clients

    lk client list

#### Displaying client info

    lk client show \[--json\] client_number

#### Available client setting names

##### name
  **Required.** Name of the client, displayed in invoices.

##### address
  **Required.** Address of the client, displayed in invoices.

##### zip_code
  **Required.** ZIP code of the client, displayed in invoices.

##### city
  **Required.** City of the client, displayed in invoices.

##### country
  Country of the client, displayed in invoices.

##### client_number
  Number of the client. If not set, the id of the client in DB is used.

### Managing invoices

  All invoice commands target the latest non-billed invoice unless invoice 
  number is specified.


#### Adding a new invoice 

    lk invoice add \[--invoice-number 1\] \[--date 1970-01-01\] \[--due-date 1970-01-14\]  \[--due-days 14\]

  If invoice number is specified, the number of the next invoice is not 
  incremented. This can be used to bring in invoices generated by other sources
  having their own distinct sequences.

#### Removing an invoice 

    lk invoice remove \[--invoice-number 1\]

  Billed invoices cannot be removed.

#### Displaying 

    lk invoice show \[--json\] \[--invoice-number 1\]
 
#### Generating invoice HTML

    lk invoice generate \[--invoice-number 1\] \[--filename output.html\]

  If filename is omitted, a filename is generated using the default template.

#### Marking an invoice as billed

    lk invoice bill \[--invoice-number 1\]

#### Marking an invoice as unbilled

    lk invoice unbill \[--invoice-number 1\]

  Unbilling marks the bill as unbilled, but does not generate a new bill to
  void it.

### Managing invoice rows
    
  All row commands target the latest non-billed invoice unless invoice number 
  is specified.

  Invoices that are billed cannot be edited.

#### Adding a row

    lk row add \[--invoice-number 1\] \[--vat 22%\] title price-per-unit \[units\] 

  Default number for units is one.

#### Removing a row
    
    lk row remove \[--invoice-number 1\] row-index


### Managing event handlers

  Event handlers are shell commands that are executed when an event is 
  triggered.

#### Available events

  *  **on_bill** Triggered when an invoice is billed. Arguments: 
    1.  Database path
    2.  Invoice number 

  *  **on_unbill** Triggered when an invoice is unbilled. Arguments:
    1.  Database path
    2.  Invoice number

  *  **on_generate** Triggered when an invoice HTML has been generated. 
     Arguments:
    1.  Database path
    2.  Invoice number
    3.  Generated file path (absolute)

#### Adding event handlers

    lk event add event-name command

#### Removing event handlers

    lk event remove id

  Index is the number of the event handler displayed by lk event list.

#### Listing event handlers
    
    lk event list \[event-name\]

#### Triggering an event

    lk event trigger event-name \[--invoice-number\] [[arg1] ...]

  The database path argument is passed automatically. Other arguments must
  be specified on the command line.

